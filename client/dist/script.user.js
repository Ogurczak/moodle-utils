// ==UserScript==
// @name            Moodle Utils
// @author          Ogurczak
// @description     Displays time per question left
// @version         0.7.2
// @namespace       https://github.com/Ogurczak/
// @updateURL       https://github.com/Ogurczak/moodle-utils/raw/main/client/dist/script.user.js
// @match           https://*/mod/quiz/attempt*
// @match           https://*/mod/quiz*
// @match           https://github.com/Ogurczak/moodle-utils*
// @match           https://*.moodlecloud.com/*
// @grant           GM_addStyle
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           GM_registerMenuCommand
// @grant           GM_getResourceText
// @resource        css https://raw.githubusercontent.com/Ogurczak/moodle-utils/{{pre-push:branch}}/client/resources/style.css
// @require         https://raw.github.com/odyniec/MonkeyConfig/master/monkeyconfig.js
// @require         http://code.jquery.com/jquery-3.4.1.min.js
// ==/UserScript==
!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e,n){a(t,e),e.set(t,n)}function a(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function u(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function c(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,l(t,e,"get"))}function f(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,l(t,e,"set"),n),n}function l(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}n.r(e);var s=new WeakMap,p=new WeakMap,y=new WeakMap,d=new WeakMap,h=new WeakSet,b=function(){function t(e,n,r){var u,c;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),a(u=this,c=h),c.add(u),i(this,d,{get:v,set:void 0}),i(this,s,{writable:!0,value:void 0}),i(this,p,{writable:!0,value:void 0}),i(this,y,{writable:!0,value:void 0}),o(this,"onFail",(function(){})),o(this,"onSuccess",(function(){})),f(this,s,e),f(this,p,n),f(this,y,r)}var e,n,c;return e=t,c=[{key:"fromQuizURL",value:function(e,n){var r=new URL(n),o=r.searchParams.get("cmid"),i=r.searchParams.get("attempt");if(null===o)throw new Error("required 'cmid' query not found in url");if(null===i)throw new Error("required 'attempt' query not found in url");return new t(e,o,i)}}],(n=[{key:"postAnswers",value:function(t){return $.ajax({url:u(this,h,w).call(this,"gather-form"),type:"post",data:JSON.stringify(t),contentType:"application/json",dataType:"json"}).fail(this.onFail).done(this.onSuccess)}},{key:"getAnswers",value:function(t){for(var e=u(this,h,w).call(this,"get-answers"),n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];for(var i=0,a=r;i<a.length;i++){var c=a[i];e+="&q=".concat(encodeURIComponent(c.text))}return $.getJSON(e,t).fail(this.onFail).done(this.onSuccess)}}])&&r(e.prototype,n),c&&r(e,c),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(){return"cmid=".concat(c(this,p),"&attempt=").concat(c(this,y))}function w(t){return"".concat(c(this,s),"/").concat(t,"?").concat(c(this,d))}function m(t){return $(t).addClass("moodleutils")}function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return j(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function O(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function S(t,e,n){return e&&O(t.prototype,e),n&&O(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function T(t,e,n){E(t,e),e.set(t,n)}function E(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function x(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,k(t,e,"get"))}function P(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,k(t,e,"set"),n),n}function k(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var _=new WeakMap,A=new WeakMap,C=new WeakSet,R=S((function t(e){var n,r,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),E(n=this,r=C),r.add(n),T(this,_,{writable:!0,value:void 0}),T(this,A,{writable:!0,value:void 0});var i=m("<div>").addClass("perquestion").text("Åšrednio na pytanie ").appendTo(".othernav"),a=m("<span>").addClass("timerperquestion").appendTo(i);P(this,A,a[0]),P(this,_,e);var u=e.update;e.update=function(){u(),function(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}(o,C,I).call(o)}}));function I(){var t=$(".qnbutton.notyetanswered").length;if(0!=t){var e=(x(this,_).endtime-(new Date).getTime())/1e3/t,n=Math.floor(e/60),r=g((e%60).toFixed(3).split("."),2),o=r[0],i=r[1],a="".concat(n,":").concat(o.padStart(2,"0"),".").concat(i);x(this,A).innerHTML=a}}function W(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function z(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function q(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,B(t,e,"set"),n),n}function B(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var U=new WeakMap,F=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),z(this,U,{writable:!0,value:void 0}),q(this,U,new MonkeyConfig({title:"Moodle Utils Configuration",menuCommand:!0,params:{serverAddress:{type:"text",default:""}}}))}var e,n,r;return e=t,(n=[{key:"serverAddress",get:function(){return(t=this,e=U,function(t,e){return e.get?e.get.call(t):e.value}(t,B(t,e,"get"))).get("serverAddress");var t,e}}])&&W(e.prototype,n),r&&W(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function D(t){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){if(e&&("object"===D(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return N(t)}function N(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function G(t){var e="function"==typeof Map?new Map:void 0;return(G=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return J(t,arguments,K(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),H(r,t)})(t)}function J(t,e,n){return(J=Q()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&H(o,n.prototype),o}).apply(null,arguments)}function Q(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function H(t,e){return(H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function K(t){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function V(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function X(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Z(t,e,n){return e&&X(t.prototype,e),n&&X(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function tt(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function nt(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,rt(t,e,"set"),n),n}function rt(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var ot=new WeakMap,it=function(){function t(e){V(this,t),tt(this,ot,{writable:!0,value:void 0}),nt(this,ot,e)}return Z(t,[{key:"html",get:function(){return function(t,e){return e.get?e.get.call(t):e.value}(t=this,rt(t,ot,"get"));var t}}]),t}();function at(t){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ut(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||ft(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ct(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=ft(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function ft(t,e){if(t){if("string"==typeof t)return lt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lt(t,e):void 0}}function lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function st(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function pt(t,e){return(pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function yt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=bt(t);if(e){var o=bt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return dt(this,n)}}function dt(t,e){if(e&&("object"===at(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ht(t)}function ht(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function bt(t){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vt(t,e){mt(t,e),e.add(t)}function wt(t,e,n){mt(t,e),e.set(t,n)}function mt(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function gt(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function jt(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,function(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}(t,e,"get"))}et(it,"ConstructionError",function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&H(t,e)}(o,t);var e,n,r=(e=o,n=Q(),function(){var t,r=K(e);if(n){var o=K(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return L(this,t)});function o(t,e){var n;return V(this,o),et(N(n=r.call(this,"#".concat(t.id," construction: ").concat(e))),"htmlElement",void 0),n.htmlElement=t,n}return Z(o)}(G(Error)));var Ot=new WeakMap,St=new WeakMap,Tt=new WeakSet,Et=new WeakSet,xt=new WeakSet,Pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pt(t,e)}(i,t);var e,n,r,o=yt(i);function i(t,e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),vt(ht(n=o.call(this,t,e)),xt),vt(ht(n),Et),vt(ht(n),Tt),wt(ht(n),Ot,{writable:!0,value:new Map}),wt(ht(n),St,{writable:!0,value:new Map});var r,a=ct($("[value!=-1]:radio, :checkbox",t));try{for(a.s();!(r=a.n()).done;){var u=r.value,c=$("~ .d-flex",u),f=m("<span>").addClass("answercounter").text(0).appendTo(c)[0],l=$("div.flex-fill",c).text();jt(ht(n),Ot).set(l,f),jt(ht(n),St).set(u,l)}}catch(t){a.e(t)}finally{a.f()}var s=$(".qtype_multichoice_clearchoice a",t)[0];return s?($(t).on("change",gt(ht(n),Et,_t)),$(s).on("click",gt(ht(n),xt,At)),$("[value!=-1]:radio:checked",t).trigger("change")):($(t).on("change",gt(ht(n),Tt,kt)),$(":checkbox:checked",t).trigger("change")),n}return e=i,(n=[{key:"update",value:function(t){var e,n=ct(jt(this,Ot));try{for(n.s();!(e=n.n()).done;){var r=ut(e.value,2),o=r[0],i=r[1],a=t[o]||"0";i.innerText=a}}catch(t){n.e(t)}finally{n.f()}}}])&&st(e.prototype,n),r&&st(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ee);function kt(){var t,e={},n=e[this.text]=[],r=ct($(":checkbox:checked",this.html));try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push(jt(this,St).get(o))}}catch(t){r.e(t)}finally{r.f()}this.connection.postAnswers(e)}function _t(t){var e={};e[this.text]=[jt(this,St).get(t.target)],this.connection.postAnswers(e)}function At(){var t={};t[this.text]=[],this.connection.postAnswers(t)}function Ct(t){return(Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||Mt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Mt(t,e){if(t){if("string"==typeof t)return $t(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$t(t,e):void 0}}function $t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function It(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Wt(t,e){return(Wt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function zt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Ut(t);if(e){var o=Ut(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return qt(this,n)}}function qt(t,e){if(e&&("object"===Ct(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Bt(t)}function Bt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ut(t){return(Ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ft(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Dt(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}function Lt(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Nt(t,e,"set"),n),n}function Nt(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var Gt=new WeakMap,Jt=new WeakSet,Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wt(t,e)}(i,t);var e,n,r,o=zt(i);function i(t,e){var n,r,a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n=o.call(this,t,e),Ft(r=Bt(n),a=Jt),a.add(r),function(t,e,n){Ft(t,e),e.set(t,n)}(Bt(n),Gt,{writable:!0,value:void 0});var u=$(".formulation",t),c=m("<div>").addClass("topanswers").appendTo(u);Lt(Bt(n),Gt,c[0]),m("<div>").addClass("topshortanswerslabel").text("Najliczniejsze odpowiedzi:").appendTo(c);for(var f=0;f<5;f++){var l=m("<div>").addClass("topshortanswer").appendTo(c);m("<div>").addClass("topshortanswercontent").appendTo(l),m("<div>").addClass("answercounter").appendTo(l)}return $(t).on("change",Dt(Bt(n),Jt,Ht)),$(":text",t).on("keypress",(function(t){"Enter"==t.key&&Dt(Bt(n),Jt,Ht).call(Bt(n),t)})),$(":text",t).trigger("change"),n}return e=i,(n=[{key:"update",value:function(t){var e,n,r,o=Object.entries(t).sort((function(t,e){return parseInt(e[1])-parseInt(t[1])})),i=$((e=this,n=Gt,function(t,e){return e.get?e.get.call(t):e.value}(e,Nt(e,n,"get")))).children(".topshortanswer").first(),a=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Mt(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}(o);try{for(a.s();!(r=a.n()).done;){var u=Rt(r.value,2),c=u[0],f=u[1];if(0==i.length)break;i.children(".topshortanswercontent").text(c),i.children(".answercounter").text(f),i=i.next()}}catch(t){a.e(t)}finally{a.f()}for(;0!=i.length;)i.children(".topshortanswercontent").text(""),i.children(".answercounter").text(""),i=i.next()}}])&&It(e.prototype,n),r&&It(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ee);function Ht(t){var e={},n=t.target.value.trim();e[this.text]=""==n?[]:[n],this.connection.postAnswers(e)}function Yt(t){return(Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Kt(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Vt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vt(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function Vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Zt(t,e){return(Zt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function te(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=re(t);if(e){var o=re(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ee(this,n)}}function ee(t,e){if(e&&("object"===Yt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return ne(t)}function ne(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function re(t){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function oe(t,e,n){ie(t,e),e.set(t,n)}function ie(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ae(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ce(t,e,"get"))}function ue(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,ce(t,e,"set"),n),n}function ce(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var fe=new WeakMap,le=new WeakMap,se=new WeakSet,pe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zt(t,e)}(i,t);var e,n,r,o=te(i);function i(t,e){var n,r,a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),n=o.call(this,t,e),ie(r=ne(n),a=se),a.add(r),oe(ne(n),fe,{writable:!0,value:void 0}),oe(ne(n),le,{writable:!0,value:void 0});var u,c=null,f=null,l=Kt($(":radio",t));try{for(l.s();!(u=l.n()).done;){var s=u.value,p=m("<span>").addClass("answercounter").text(0).appendTo(s.parentElement)[0];switch(s.value){case"0":f=p;break;case"1":c=p}}}catch(t){l.e(t)}finally{l.f()}if(null===c||null===f)throw new it.ConstructionError(t,"TrueFalse: no have true and/or false radio");return ue(ne(n),fe,c),ue(ne(n),le,f),$(t).on("change",function(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return n}(ne(n),se,ye)),$(":radio:checked",t).trigger("change"),n}return e=i,(n=[{key:"update",value:function(t){ae(this,fe).innerText=t[1]||"0",ae(this,le).innerText=t[0]||"0"}}])&&Xt(e.prototype,n),r&&Xt(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(Ee);function ye(t){var e={};e[this.text]=[t.target.value],this.connection.postAnswers(e)}function de(t){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function he(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function be(t,e){return(be=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ve(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ge(t);if(e){var o=ge(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return we(this,n)}}function we(t,e){if(e&&("object"===de(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return me(t)}function me(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ge(t){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function je(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function Oe(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Se(t,e,"set"),n),n}function Se(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var Te=new WeakMap,Ee=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&be(t,e)}(i,t);var e,n,r,o=ve(i);function i(t,e){var n,r,a,u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),je(me(n=o.call(this,t)),Te,{writable:!0,value:void 0}),r=me(n),u=void 0,(a="connection")in r?Object.defineProperty(r,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):r[a]=u,Oe(me(n),Te,i.extractText(t)),n.connection=e,n}return e=i,r=[{key:"extractText",value:function(t){return $(".qtext",t).text()}},{key:"create",value:function(t,e){var n=t.classList;return"multichoice"in n?new Pt(t,e):"truefalse"in n?new pe(t,e):"shortanswer"in n?new Qt(t,e):null}}],(n=[{key:"text",get:function(){return function(t,e){return e.get?e.get.call(t):e.value}(t=this,Se(t,Te,"get"));var t}}])&&he(e.prototype,n),r&&he(e,r),Object.defineProperty(e,"prototype",{writable:!1}),i}(it);function xe(t){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pe(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==n)return;var r,o,i=[],a=!0,u=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){u=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}(t,e)||_e(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ke(t){return function(t){if(Array.isArray(t))return Ae(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||_e(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _e(t,e){if(t){if("string"==typeof t)return Ae(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ae(t,e):void 0}}function Ae(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ce(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Re(t,e){if(e&&("object"===xe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Me(t)}function Me(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $e(t){var e="function"==typeof Map?new Map:void 0;return($e=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Ie(t,arguments,qe(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ze(r,t)})(t)}function Ie(t,e,n){return(Ie=We()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&ze(o,n.prototype),o}).apply(null,arguments)}function We(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function ze(t,e){return(ze=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function qe(t){return(qe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Be=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ze(t,e)}(u,t);var e,n,r,o,i,a=(e=u,n=We(),function(){var t,r=qe(e);if(n){var o=qe(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return Re(this,t)});function u(t,e){var n,r,o,i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),n=a.call(this),r=Me(n),i=void 0,(o="connection")in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i,$(".que",t).map((function(t,n){return Ee.create(n,e)})).each((function(t,e){n.set(e.text,e)})),n.connection=e,n}return r=u,(o=[{key:"updateAll",value:function(){var t,e=this;(t=this.connection).getAnswers.apply(t,[function(t){for(var n=0,r=Object.entries(t);n<r.length;n++){var o=Pe(r[n],2),i=o[0],a=o[1],u=e.get(i);if(void 0!==u)try{u.update(a)}catch(t){console.error("error updating question '".concat(i,"': ").concat(t))}else console.error("no question '".concat(i,"' on current page"))}}].concat(ke(this.values())))}}])&&Ce(r.prototype,o),i&&Ce(r,i),Object.defineProperty(r,"prototype",{writable:!1}),u}($e(Map));function Ue(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Fe(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function De(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ne(t,e,"get"))}function Le(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,Ne(t,e,"set"),n),n}function Ne(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}var Ge,Je=new WeakMap,Qe=new WeakMap,He=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Fe(this,Je,{writable:!0,value:void 0}),Fe(this,Qe,{writable:!0,value:"unknown"}),Le(this,Je,m("<div>").text("Moodle Utils server status: ").addClass("status unknown")),De(this,Je).appendTo(e)}var e,n,r;return e=t,(n=[{key:"status",get:function(){return De(this,Qe)},set:function(t){De(this,Je).removeClass(this.status),De(this,Je).addClass(t),Le(this,Qe,t)}}])&&Ue(e.prototype,n),r&&Ue(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();
// ==UserScript==
// @name            Moodle Utils
// @author          Ogurczak
// @description     Displays time per question left
// @version         0.7.2
// @namespace       https://github.com/Ogurczak/
// @updateURL       https://github.com/Ogurczak/moodle-utils/raw/main/client/dist/script.user.js
// @match           https://*/mod/quiz/attempt*
// @match           https://*/mod/quiz*
// @match           https://github.com/Ogurczak/moodle-utils*
// @match           https://*.moodlecloud.com/*
// @grant           GM_addStyle
// @grant           GM_getValue
// @grant           GM_setValue
// @grant           GM_registerMenuCommand
// @grant           GM_getResourceText
// @resource        css https://raw.githubusercontent.com/Ogurczak/moodle-utils/{{pre-push:branch}}/client/resources/style.css
// @require         https://raw.github.com/odyniec/MonkeyConfig/master/monkeyconfig.js
// @require         http://code.jquery.com/jquery-3.4.1.min.js
// ==/UserScript==
Ge=new F,/^https:\/\/.*\/mod\/quiz\/attempt.*$/.test(window.location.href)&&Y.on("domready",(function(){if(GM_addStyle(GM_getResourceText("css")),0!=$(".qnbutton.notyetanswered").length&&0!=M.mod_quiz.timer.endtime&&new R(M.mod_quiz.timer),""!=Ge.serverAddress){var t=new He($("#mod_quiz_navblock > .card-body")),e=b.fromQuizURL(Ge.serverAddress,window.location.href);e.onFail=function(){return t.status="failed"},e.onSuccess=function(){return t.status="ok"};var n=new Be(document.body,e);0!=n.size&&window.setInterval((function(){return n.updateAll}),1e3)}}))}]);